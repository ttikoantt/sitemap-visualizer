# Sitemap Visualizer - 要件定義書

## プロジェクト概要

URLリスト（CSV/Excel）をインポートし、インタラクティブなビジュアルサイトマップを生成するWebアプリケーション。

## 機能要件

### F1: ファイルインポート
- CSV（.csv, .tsv, .txt）ファイルのアップロード（ドラッグ＆ドロップ対応）
- Excel（.xlsx, .xls）ファイルのアップロード
- URL列の自動検出（"url", "URL", "address", "link"等のヘッダーを認識）
- ヘッダーなしCSVにも対応（先頭列をURL列として使用）

### F2: URL解析・ツリー構築
- URLの正規化（プロトコル補完、末尾スラッシュ除去、ホスト名小文字化）
- URLパスに基づく階層ツリー構造の構築（Trieアルゴリズム）
- 重複URLの自動除去
- 不正URLのスキップ（エラーにならず警告）

### F3: インタラクティブ可視化
- Miro/Figmaライクなスムーズなズーム・パン操作
- URLを箱型カードノードで表示
- 階層構造が視覚的に明確なツリーレイアウト
- ミニマップによるナビゲーション
- レイアウト方向切替（縦/横）

### F4: ページパターン自動分類（v1 - URLベース）
- URLパス構造に基づくパターン検出
  - 数値ID: `/products/123` → `/products/{id}`
  - UUID: `/items/550e8400-e29b-41d4-...`
  - スラッグ: `/blog/my-first-post` → `/blog/{slug}`
  - 日付: `/blog/2024/01` → `/blog/{year}/{month}`
  - 混合: 上記に該当しないパラメータ
- ページタイプ分類:
  - **一覧ページ**: 子ノードを持つ、一覧系キーワード含む
  - **詳細ページ**: 動的セグメントで終端、兄弟多数
  - **固定ページ**: 静的セグメント、兄弟少数
  - **ページネーション**: `/page/{number}` パターン
- 同じパターンのページは同じ色で表示
- パターン凡例の表示

### F5: ノード詳細表示
- ノードクリックで詳細パネル表示（右サイドバー）
- 表示内容:
  - フルパス
  - ページタイプとその判定理由
  - パターングループ情報（パターン名、説明文）
  - セグメント分析テーブル（各セグメントのタイプ・値）
  - サンプルURLリスト

### F6: サンプルデータ
- 「サンプルデータで試す」ボタン（32 URL, 複数パターン含む）

## 非機能要件

### NF1: ホスティング
- GitHub Pagesで静的ホスティング（バックエンド不要）
- GitHub Actionsによる自動デプロイ

### NF2: パフォーマンス
- 1000+ URLのパース・ツリー構築が1秒以内
- レイアウト計算が3秒以内

### NF3: 技術スタック
- React + TypeScript + Vite
- React Flow（@xyflow/react）
- ELK.js（elkjs）
- Papa Parse + SheetJS
- Zustand
- Vitest + React Testing Library

### NF4: テスト
- TDD開発アプローチ
- カバレッジ目標: statements 80%+

## 今後の拡張（v2: Phase 7）

### F7: スクリーンショット/DOM取得によるパターン強化
- ページスクリーンショットの取得・表示
- DOM構造に基づくパターン再分類
- ノード詳細画面の拡充（スクショ、メタ情報、DOM構造）
- 画像比較（SSIM.js, pHash）によるビジュアルパターン分類
- ボット対策回避（レート制限遵守、API経由、Chrome拡張）

詳細は [計画書の Phase 7 セクション](../docs/drafts/phase7-plan.md) を参照。
